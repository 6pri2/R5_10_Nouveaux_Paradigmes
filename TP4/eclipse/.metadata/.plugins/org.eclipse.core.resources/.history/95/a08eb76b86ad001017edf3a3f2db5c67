package SQL;

import java.sql.*;

public class AppliSQL {
	 private Connection conn;

	    public void connecter() {
	    	try {
	    		Class.forName("mongodb.jdbc.MongoDriver");
	    	} catch (Exception e) {
	    		System.out.println("erreur driver");
	            e.printStackTrace();
	        }
	        try {
	            String url = "jdbc:mongo://127.0.0.1:27017/maBDDTP4"; 
	            conn = DriverManager.getConnection(url,"","");

	            System.out.println("Connection to the database has been established...");

	            DatabaseMetaData meta = conn.getMetaData();
	            System.out.println("Nom Driver JDBC : " + meta.getDriverName());
	            System.out.println("Version Driver JDBC : " + meta.getDriverVersion());
	            System.out.println("Nom BDD : " + meta.getDatabaseProductName());
	            System.out.println("Version BDD : " + meta.getDatabaseProductVersion());

	        } catch (Exception e) {
	            e.printStackTrace();
	        }
	    }
	    public void lireDonnees() {
	        try (Statement stmt = conn.createStatement()) {
	            ResultSet rs = stmt.executeQuery("SELECT * FROM personnes");

	            ResultSetMetaData meta = rs.getMetaData();
	            int columnCount = meta.getColumnCount();

	            while (rs.next()) {
	                for (int i = 1; i <= columnCount; i++) {
	                    System.out.print(rs.getString(i));
	                    if (i < columnCount) System.out.print(", ");
	                }
	                System.out.println();
	            }
	        } catch (SQLException e) {
	            e.printStackTrace();
	        }
	    }

	    public void modifierDonnees() {
	        try (Statement stmt = conn.createStatement()) {
	            stmt.executeUpdate("UPDATE personnes SET prenom = 'Etama' WHERE _id = 3");
	            System.out.println("Données modifiées !");
	        } catch (SQLException e) {
	            e.printStackTrace();
	        }
	    }

	    public void supprimerDonnees() {
	        try (Statement stmt = conn.createStatement()) {
	            stmt.executeUpdate("DELETE FROM personnes WHERE _id = 6");
	            stmt.executeUpdate("DELETE FROM personnes WHERE _id = 7");
	            System.out.println("Données supprimées !");
	        } catch (SQLException e) {
	            e.printStackTrace();
	        }
	    }

	    public void fermerConnexion() {
	        try {
	            if (conn != null && !conn.isClosed()) {
	                conn.close();
	                System.out.println("Connexion fermée !");
	            }
	        } catch (SQLException e) {
	            e.printStackTrace();
	        }
	    }

	    public void lireDonneesEcoles() {
	        try (Statement stmt = conn.createStatement()) {
	            ResultSet rs = stmt.executeQuery("SELECT * FROM mesecoles");

	            ResultSetMetaData meta = rs.getMetaData();
	            int columnCount = meta.getColumnCount();

	            while (rs.next()) {
	                for (int i = 1; i <= columnCount; i++) {
	                    System.out.print(rs.getString(i));
	                    if (i < columnCount) System.out.print(", ");
	                }
	                System.out.println();
	            }
	        } catch (SQLException e) {
	            System.out.println("Erreur dans lireDonneesEcoles : " + e.getMessage());
	        }
	    }

	    
}
